<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS Hash Chain Explorer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>ðŸ”— LMS Hash Chain Explorer</h1>
                    <p class="subtitle">Verifiable State Chain Explorer</p>
                </div>
                <div class="auth-section">
                    <span id="userInfo" style="display: none;">
                        <span id="usernameDisplay"></span>
                        <button id="logoutBtn" class="auth-btn logout-btn">Logout</button>
                    </span>
                    <span id="loginSection">
                        <button id="loginBtn" class="auth-btn">Login</button>
                        <button id="registerBtn" class="auth-btn">Register</button>
                    </span>
                </div>
            </div>
        </header>

        <!-- Search Bar -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search by key_id, hash, or index..." class="search-input">
                <button id="searchBtn" class="search-btn">Search</button>
            </div>
            <div class="search-hint">
                <span>Examples: <code>lms_key_1</code>, <code>g5WYnCjbDHzQdzvb7uOkmueXZHxbt5VOIO5oLCAi6zQ=</code></span>
            </div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-section" id="statsSection">
            <div class="stat-card">
                <div class="stat-label">Total Keys</div>
                <div class="stat-value" id="statTotalKeys">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Commits</div>
                <div class="stat-value" id="statTotalCommits">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Valid Chains</div>
                <div class="stat-value valid" id="statValidChains">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Broken Chains</div>
                <div class="stat-value broken" id="statBrokenChains">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Last Updated</div>
                <div class="stat-value small" id="statLastUpdate">-</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs" id="mainTabs">
            <button class="tab-btn active" data-tab="explorer">Public Explorer</button>
            <button class="tab-btn" data-tab="mykeys" id="myKeysTab" style="display: none;">My Keys</button>
        </div>

        <!-- Public Explorer Tab -->
        <div class="tab-content active" id="explorerTab">
            <!-- Recent Commits Table -->
            <div class="section">
                <div class="section-header">
                    <h2>Recent Commits</h2>
                    <div>
                        <button id="viewBlockchainBtn" class="refresh-btn" style="margin-right: 10px;">ðŸ”— View Blockchain</button>
                        <button id="refreshBtn" class="refresh-btn">ðŸ”„ Refresh</button>
                    </div>
                </div>
                <div id="recentCommits" class="table-container">
                    <div class="loading">Loading recent commits...</div>
                </div>
            </div>

            <!-- Search Results -->
            <div class="section" id="searchResultsSection" style="display: none;">
                <div class="section-header">
                    <h2>Search Results</h2>
                    <button id="clearSearchBtn" class="clear-btn">Clear</button>
                </div>
                <div id="searchResults" class="results-container"></div>
            </div>

            <!-- Chain View -->
            <div class="section" id="chainSection" style="display: none;">
                <div class="section-header">
                    <h2 id="chainTitle">Chain View</h2>
                    <button id="closeChainBtn" class="close-btn">Close</button>
                </div>
                <div id="chainView" class="chain-container"></div>
            </div>

            <!-- Blockchain View -->
            <div class="section" id="blockchainSection" style="display: none;">
                <div class="section-header">
                    <h2>Blockchain Commits (CHIPS/Verus)</h2>
                    <div>
                        <button id="refreshBlockchainBtn" class="refresh-btn">ðŸ”„ Refresh</button>
                        <button id="closeBlockchainBtn" class="close-btn">Close</button>
                    </div>
                </div>
                <div id="blockchainView" class="table-container"></div>
            </div>
        </div>

        <!-- My Keys Tab (Authenticated) -->
        <div class="tab-content" id="myKeysTabContent" style="display: none;">
            <div class="section">
                <div class="section-header">
                    <h2>My LMS Keys</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="importKeyBtn" class="refresh-btn">ðŸ“¥ Import Key</button>
                        <button id="generateKeyBtn" class="refresh-btn">âž• Generate Key</button>
                    </div>
                </div>
                <div id="myKeysList" class="table-container">
                    <div class="loading">Loading your keys...</div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Sign Message</h2>
                </div>
                <div class="sign-form">
                    <div class="form-group">
                        <label for="signKeySelect">Select Key:</label>
                        <select id="signKeySelect" class="form-input">
                            <option value="">-- Select a key --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="signMessageInput">Message:</label>
                        <textarea id="signMessageInput" class="form-input" rows="4" placeholder="Enter message to sign..."></textarea>
                    </div>
                    <button id="signBtn" class="search-btn">Sign Message</button>
                    <div id="signResult" style="display: none;"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Verify Signature</h2>
                </div>
                <div class="sign-form">
                    <form id="verifySignatureForm">
                        <div class="form-group">
                            <label for="verifyKeySelect">Select Key (optional):</label>
                            <select id="verifyKeySelect" class="form-input">
                                <option value="">Use public key from signature</option>
                            </select>
                            <small>If not selected, public key from signature will be used</small>
                        </div>
                        <div class="form-group">
                            <label for="verifyMessageInput">Original Message:</label>
                            <textarea id="verifyMessageInput" class="form-input" rows="4" placeholder="Enter the original message that was signed..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="verifySignatureInput">Signature JSON:</label>
                            <textarea id="verifySignatureInput" class="form-input" rows="6" placeholder="Paste signature JSON here..." required></textarea>
                            <small>Or upload signature file: <input type="file" id="verifySignatureFile" accept=".json" style="margin-left: 10px;"></small>
                        </div>
                        <button type="submit" id="verifyBtn" class="search-btn">Verify Signature</button>
                        <div id="verifyResult" style="display: none;"></div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" data-modal="loginModal">&times;</span>
                <h2>Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginUsername">Username:</label>
                        <input type="text" id="loginUsername" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" class="form-input" required>
                    </div>
                    <button type="submit" class="search-btn">Login</button>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                </form>
            </div>
        </div>

        <!-- Import Key Modal -->
        <div id="importKeyModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close-modal" data-modal="importKeyModal">&times;</span>
                <h2>Import Key</h2>
                <form id="importKeyForm">
                    <div class="form-group">
                        <label for="importKeyData">Exported Key JSON:</label>
                        <textarea id="importKeyData" class="form-input" rows="6" placeholder='Paste exported key JSON here...&#10;{&#10;  "private_key": "...",&#10;  "public_key": "...",&#10;  "index": 0,&#10;  ...&#10;}'></textarea>
                        <small>Or upload a JSON file:</small>
                        <input type="file" id="importKeyFile" accept=".json" style="margin-top: 5px; width: 100%;">
                    </div>
                    <div class="form-group">
                        <label for="importKeyId">New Key ID (optional):</label>
                        <input type="text" id="importKeyId" class="form-input" placeholder="Leave empty to auto-generate">
                        <small>If not provided, a new key_id will be generated for you</small>
                    </div>
                    <button type="submit" class="search-btn">Import Key</button>
                    <div id="importKeyError" class="error-message" style="display: none;"></div>
                </form>
            </div>
        </div>

        <!-- Register Modal -->
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" data-modal="registerModal">&times;</span>
                <h2>Register</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerUsername">Username:</label>
                        <input type="text" id="registerUsername" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email (optional):</label>
                        <input type="email" id="registerEmail" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password:</label>
                        <input type="password" id="registerPassword" class="form-input" required minlength="6">
                        <small>Minimum 6 characters</small>
                    </div>
                    <button type="submit" class="search-btn">Register</button>
                    <div id="registerError" class="error-message" style="display: none;"></div>
                </form>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script src="/static/auth.js"></script>
    <script src="/static/mykeys.js"></script>
    <script src="/static/export_import.js"></script>
    <script src="/static/verify.js"></script>
</body>
</html>

